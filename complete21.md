
---

## § 5.3. Синхронизация учетных подсистем: Складской и Стоимостной учет

В архитектуре «1С:Предприятия» данные одного бизнес-события (списания материалов в производство) часто должны быть отражены одновременно в нескольких целевых таблицах — регистрах накопления. В вашем коде реализована **атомарная операция списания**, которая гарантирует, что количество товара на складе всегда соответствует его остаточной стоимости в финансовом контуре.

---

### Граф I. Регистр «СебестоимостьТоваров»: Финансовый контур

Первый блок движений отвечает за управленческий и бухгалтерский учет стоимости. Здесь важна не только номенклатура, но и конкретный «денежный мешок» — **Партия**.

```bsl
ДвS = Движения.СебестоимостьТоваров.Добавить();
ДвS.ВидДвижения = ВидДвиженияНакопления.Расход;
ДвS.Период = Дата;
ДвS.Номенклатура = Стр.Номенклатура;
ДвS.Партия = Парт.Партия; // Указываем конкретный документ поступления
ДвS.Количество = Факт;    // Списываем количество
ДвS.Стоимость = СуммаСпис; // Списываем рассчитанную стоимость по FIFO

```

**Теоретическая база:**
Запись в этот регистр позволяет системе ответить на вопрос: *«На какую сумму мы потребили ресурсов?»*. Обратите внимание, что здесь нет измерения `Склад`. Это связано с тем, что себестоимость в крупных системах часто считается «в целом по компании» или по организациям, вне зависимости от того, на каком конкретно складе лежал товар.

---

### Граф II. Регистр «ОстаткиТоваров»: Логистический контур

Второй блок движений отражает физическое движение ТМЦ (товарно-материальных ценностей) на конкретном месте хранения.

```bsl
ДвO = Движения.ОстаткиТоваров.Добавить();
ДвO.ВидДвижения = ВидДвиженияНакопления.Расход;
ДвO.Период = Дата;
ДвO.Склад = СкладМатериалов; // Фиксируем место хранения
ДвO.Номенклатура = Стр.Номенклатура;
ДвO.Количество = Факт;       // Только количественный учет

```

**Теоретическая база:**
В отличие от финансового регистра, здесь обязательно присутствует измерение **Склад**. Складскому работнику не важно, сколько стоил этот болт или из какой он партии, ему важно, что на полке стало на 10 штук меньше.

* **Синхронность:** Переменная `Факт` используется в обоих регистрах. Это критически важно для соблюдения баланса: нельзя списать стоимость 10 единиц, а со склада убрать только 5.
